services:
  backend:
    build:
      context: ..
      dockerfile: docker/backend.Dockerfile
    environment:
      PRINTMUX_API_KEY: "${PRINTMUX_API_KEY:-changeme}"
      PRINTMUX_STORAGE_DIR: "/app/storage"
      PRINTMUX_DATABASE_URL: "${PRINTMUX_DATABASE_URL:-sqlite:////app/data/printmux.db}"
      PRINTMUX_CORS_ORIGINS: "${PRINTMUX_CORS_ORIGINS:-*}"
    ports:
      - "${PRINTMUX_BACKEND_PORT:-8000}:8000"
    volumes:
      - printmux_storage:/app/storage
      - printmux_data:/app/data

  frontend:
    build:
      context: ..
      dockerfile: docker/frontend.Dockerfile
    environment:
      VITE_BACKEND_PORT: "${PRINTMUX_BACKEND_PORT:-8000}"
      VITE_HOST: "${VITE_HOST:-}"
    ports:
      - "${PRINTMUX_FRONTEND_PORT:-5173}:5173"
    depends_on:
      - backend

volumes:
  printmux_storage:
  printmux_data:
