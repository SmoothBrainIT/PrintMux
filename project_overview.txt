Project Name: PrintMux

Overview
PrintMux is an open-source middleware application that sits between slicers and multiple Klipper (Moonraker)-compatible 3D printers. PrintMux presents itself to slicers as a single Moonraker-compatible instance and a minimal OctoPrint-compatible instance, while internally routing uploaded GCODE or 3MF files to one or more real printers selected by the user through a web interface.

The primary goal is to allow a user to add exactly one “printer” in a slicer, upload a job once, and then decide which physical printers should receive and optionally start that job.

PrintMux is designed first as a self-hosted maker tool, with future monetization paths such as hosted offerings or paid extensions.

Goals
- Act as a virtual Moonraker server for slicers
- Provide a minimal OctoPrint-compatible endpoint for slicers that require it
- Accept file uploads and print commands from slicers
- Provide a web UI for selecting one or more target printers
- Upload files to downstream printers via their Moonraker APIs
- Optionally start prints on selected printers
- Remain lightweight, auditable, and easy to self-host
- Be extensible for future scheduling, automation, and farm features

Non-Goals (for initial versions)
- Full Moonraker feature parity
- Webcam proxying
- Live GCODE streaming
- Deep printer control beyond upload and start
- Cloud dependency

High-Level Flow

Slicer Flow
1. User adds PrintMux as a printer in their slicer using Moonraker compatibility.
2. User slices a model.
3. User selects “Upload” or “Upload & Print”.
4. Slicer uploads the file to PrintMux via Moonraker- or OctoPrint-compatible endpoints.
5. PrintMux stores the file and creates a pending job.
6. Slicer upload completes successfully.

User Flow
1. User clicks “Web UI” in the slicer device tab.
2. Browser opens the PrintMux web interface.
3. The most recent uploaded job is highlighted.
4. User selects one or more target printers.
5. User chooses:
   - Upload only
   - Upload and start print
6. PrintMux dispatches the job to each selected printer.
7. Per-printer results are displayed.

System Architecture

Core Components
1. Slicer-Facing API
   - Emulates a minimal subset of Moonraker’s REST API
   - Emulates a minimal subset of OctoPrint’s REST API for legacy slicers
   - Handles authentication
   - Accepts file uploads
   - Accepts optional print start commands
   - Returns simple printer state responses

2. Job Manager
   - Stores uploaded files on disk
   - Tracks jobs and job state
   - Associates jobs with selected printers
   - Handles retries and partial failures

3. Printer Dispatcher
   - Communicates with real Moonraker servers
   - Uploads files using Moonraker file APIs
   - Starts prints via Moonraker job APIs
   - Collects success or error results per printer

4. Web UI
   - Job inbox and history
   - Printer management
   - Printer selection for each job
   - Status visibility

5. Persistence Layer
   - Database for metadata
   - Filesystem for uploaded GCODE and 3MF files

Technology Preferences
- Backend: Python with FastAPI
- Frontend: React with Vite
- Database: PostgreSQL (SQLite acceptable for development)
- Background jobs: Redis + RQ or Celery
- Deployment: Docker and Docker Compose

Repository Structure

printmux/
├── backend/
│   ├── app/
│   │   ├── api/
│   │   │   ├── octoprint_compat/
│   │   │   ├── printers/
│   │   │   ├── jobs/
│   │   │   └── auth/
│   │   ├── core/
│   │   │   ├── config.py
│   │   │   ├── database.py
│   │   │   ├── storage.py
│   │   │   └── security.py
│   │   ├── models/
│   │   ├── services/
│   │   │   ├── dispatcher.py
│   │   │   └── octoprint_client.py
│   │   ├── workers/
│   │   └── main.py
│   └── requirements.txt
├── frontend/
│   ├── src/
│   │   ├── pages/
│   │   ├── components/
│   │   ├── api/
│   │   └── main.tsx
│   └── package.json
├── docker/
│   ├── backend.Dockerfile
│   ├── frontend.Dockerfile
│   └── docker-compose.yml
├── docs/
│   └── api.md
├── scripts/
└── README.md

Data Model (Minimal)

Printer
- id
- name
- base_url
- api_key
- enabled
- tags
- created_at

File
- id
- original_filename
- storage_path
- file_hash
- size
- uploaded_at

Job
- id
- file_id
- status (uploaded, awaiting_selection, dispatching, completed, failed)
- created_at

JobTarget
- id
- job_id
- printer_id
- status (pending, uploaded, printing, completed, failed)
- error_message

Security
- API key required for slicer access
- Printer API keys encrypted at rest
- No arbitrary proxying of downstream APIs

Licensing
- Open source by default
- License to be determined (MIT or Apache 2.0 recommended)

Future Extensions
- Printer capability matching
- Automatic routing rules
- Job queues and scheduling
- User roles and multi-tenancy
- Notifications and webhooks
- Hosted SaaS offering
